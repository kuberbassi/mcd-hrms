rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Users
    match /users/{userId} {
      allow read, write: if request.auth != null;
    }

    // System Config
    match /system/{docId} {
      allow read, write: if request.auth != null;
    }

    // Employees
    match /employees/{docId} {
      allow read, write: if request.auth != null;
    }

    // Attendance
    match /attendance/{docId} {
      allow read, write: if request.auth != null;
    }

    // Transfers
    match /transfers/{docId} {
      allow read, write: if request.auth != null;
    }

    // Payroll
    match /payroll/{docId} {
      allow read, write: if request.auth != null;
    }

    // Performance
    match /performance/{docId} {
      allow read, write: if request.auth != null;
    }

    // Grievances
    match /grievances/{docId} {
      allow read, write: if request.auth != null;
    }

    // Tasks (Fixes the "Missing Permissions" error)
    match /tasks/{taskId} {
      allow read, write: if request.auth != null;
    }

    // Jobs (Public read, Admin write)
    match /jobs/{jobId} {
      allow read: if true;
      allow write: if request.auth != null;
    }

    // Applications (Public create, Admin read/write)
    match /applications/{applicationId} {
      allow create: if true;
      allow read, update, delete: if request.auth != null;
    }

    // Default: Deny everything else for security
    match /{document=**} {
      allow read, write: if false;
    }
  }
}